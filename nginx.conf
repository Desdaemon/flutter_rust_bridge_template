# To start an NGINX server with this config:
# sudo nginx -c nginx.conf -p . [-s reload]
# This assumes that you have run 'just build-web'.

events {}

http {
    # Basic settings for HTTP block

    # MIME types configuration, copied from /etc/nginx/mime.types
    # If on Linux, include it instead; the only important line is the WASM declaration.
    types {
        text/html html htm shtml;
        text/css css;
        image/gif gif;
        image/jpeg jpeg jpg;
        application/javascript js;

        image/png png;
        image/tiff tif tiff;
        image/x-icon ico;
        image/x-ms-bmp bmp;
        image/svg+xml svg svgz;
        image/webp webp;

        application/wasm wasm;
        application/font-woff woff;
        application/json json;

        video/mp4 mp4;
        video/mpeg mpeg mpg;
        video/quicktime mov;
        video/webm webm;
    }
    default_type  application/octet-stream;

    # Define the server block for HTTPS on localhost
    server {
        listen 80;
        # listen 443 ssl; # Listen on port 443 for HTTPS
        # server_name localhost; # Your server name (can also use your IP or domain)

        # SSL certificate configuration
        # use envsubst, or hardcode these in by yourself
        # ssl_certificate ${SSL_CERT}; # Path to your SSL certificate
        # ssl_certificate_key ${SSL_CERT_KEY}; # Path to your private key

        # SSL settings
        # ssl_protocols TLSv1.2 TLSv1.3; # Set allowed SSL protocols
        # ssl_prefer_server_ciphers on; # Prefer server ciphers over client ciphers
        # ssl_ciphers 'EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH'; # Set ciphers

        # Root directory for serving static files

        gzip on;
        gzip_types application/javascript application/wasm;

        # Additional configuration for serving static files
        location / {
            root build/web;
            try_files  $uri $uri/ =404;
            # COOP and COEP headers
            add_header Cross-Origin-Opener-Policy "same-origin";
            add_header Cross-Origin-Embedder-Policy "require-corp";
        }
    }
}
